import{r as o,j as e,G as N,t as l,B as r,d as h,S as $,H as q,R as I,h as Q,e as H,f as O,J,K as X,L as Y,g as Z,M as U,D as u,C as W,u as z,N as B,i as G,A as E,a as ee,O as te,c as se}from"./osRouter-Bk4NCNve.js";import{R as ne}from"./ResponsiblePage-BrvVx2-o.js";import{T as oe}from"./TextInput-B_CjoKoM.js";import{I as le,C as re}from"./ImgChoosing-DONBKif-.js";import{S as x}from"./SaveBox-CgIQnLrP.js";import"./index-C6EIVSk5.js";import"./AnimatedBox-Co1Q6qJJ.js";import"./FileSelector-CLRhLI_r.js";function ae({tmpDisabled:s,parentIndex:i,currentParents_RelToCurrentMem:a,set_currentParents_RelToCurrentMem:p}){const[n,_]=o.useState(a[i]??"");return e.jsx(e.Fragment,{children:e.jsx(oe,{disabled:s,placeholder:l("relation..."),placeholderTextColor:N,defaultValue:n,onBlur:c=>{a[i]=n,p(a.slice())},onChangeText:c=>{_(c)}})})}function ie({currentParents:s,set_currentParents:i,currentParents_RelToCurrentMem:a,set_currentParents_RelToCurrentMem:p}){return e.jsx(e.Fragment,{children:e.jsxs(r,{style:{},children:[e.jsxs(h,{children:[l("choose parents:")," "]}),e.jsx(r,{style:{},children:e.jsx($,{height:100,style:{borderColor:"black",borderWidth:1},children:e.jsx(r,{style:{display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center",alignContent:"center",flexWrap:"wrap"},children:s?.map((n,_)=>e.jsxs(r,{style:{borderColor:q,borderWidth:1,opacity:n.tmpDisabled?.5:1},children:[e.jsx(I,{children:e.jsxs(Q,{onPress:()=>{const c=s.findIndex(j=>j.id==n.id);s[c].tmpDisabled=!s[c].tmpDisabled,i(s.slice())},children:[e.jsx(H,{style:{backgroundColor:O},width:20,height:20,src:n.img}),e.jsxs(h,{children:["  "," ",n.title_string]}),e.jsx(J,{icon:n.tmpDisabled?"close-circle-outline":"sticker-plus",color:n.tmpDisabled?X:Y,style:{margin:0,padding:0},size:15})]})}),e.jsx(I,{children:e.jsx(ae,{currentParents_RelToCurrentMem:a,set_currentParents_RelToCurrentMem:p,parentIndex:_,tmpDisabled:n.tmpDisabled})})]},n.id))})})})]})})}const he=Z(({topMem:s,localAppSetting:i})=>{const[a,p]=o.useState(i.captionTheImg),[n,_]=o.useState(i.generate_customFields_model),[c,j]=o.useState(null),[f,w]=o.useState(""),[D,C]=o.useState(""),[v,k]=o.useState(""),[A,V]=o.useState(""),[S,R]=o.useState("general"),[P,T]=o.useState({}),[K,L]=o.useState(null),[g,y]=o.useState([]),[b,F]=o.useState([]);return o.useEffect(()=>{if(s&&(j(null),w(s.title_string),C(s.content_string),k(s.tags?.join(" ")),V(s.img??null),T(s.customFields_user),R(s.category??"general"),s.parents_id?.length)){const t=[];y(s.parents_id.map((m,d)=>{const M=U(m);return t[d]=s.parents_rel[d],{...M,tmpDisabled:!1}})),F(t)}},[s?.id]),e.jsx(e.Fragment,{children:e.jsxs(ne,{containerStyles:{},children:[e.jsx(r,{style:{flexDirection:"column",marginBottom:20},children:e.jsx(x,{testID:"addMem_title",defaultValue:f,label:"A Title here ",onSave:t=>w(t)})}),e.jsx(r,{style:{flexDirection:"column",marginBottom:20},children:e.jsx(x,{testID:"addMem_category",label:"*"+l("category"),defaultValue:S,onSave:t=>{R(t)}})}),e.jsx(r,{style:{flexDirection:"column",marginBottom:20},children:e.jsx(x,{style:{height:500},multiline:!0,testID:"addMem_content",defaultValue:D,label:l("content"),onSave:t=>C(t)})}),e.jsx(r,{style:{marginBottom:20},children:e.jsx(x,{testID:"addMem_tags",defaultValue:v,label:l("tags"),keyboardType:"numeric",onSave:t=>k(t)})}),e.jsx(u,{}),e.jsx(le,{oldImg:s?.img,currentImg:A,onImgUrlChanged:t=>{V(t)},onImgSelect:t=>{L(t)}}),e.jsx(u,{}),e.jsx(W,{testID:"addMem_captionImg",caption:l("caption the image"),defaultValue:a,onChange:t=>{p(t),z({newSetting:{captionTheImg:t}})}}),e.jsx(u,{}),e.jsx(W,{testID:"addMem_improve",caption:l("improve data retrieval and indexing of this mem"),defaultValue:n,onChange:t=>{_(t),z({newSetting:{generate_customFields_model:t}})}}),e.jsx(u,{}),e.jsx(ie,{currentParents:g,currentParents_RelToCurrentMem:b,set_currentParents:y,set_currentParents_RelToCurrentMem:F}),e.jsx(B,{height:100,onSearch:async t=>{G({text:t,dontSet_userInputSearchBox:!0})},onItemClick:t=>{if(g.find(d=>d.id===t))return E({content:l("already added!"),type:"info"}),null;const m={...U(t),tmpDisabled:!1};y([...g,m]),F([...b,""])},onUserType:async t=>{(t[0]==="@"||t[0]==="#")&&G({text:t,dontSet_userInputSearchBox:!0})}}),e.jsx(u,{}),e.jsx(re,{default_customFields_user:P??{},onUpdate:t=>{T(structuredClone(t))}}),e.jsx(u,{}),e.jsxs(r,{children:[e.jsx(ee,{testID:"addMem_submit",icon:s?.id?"plus-network":"shape-rectangle-plus",mode:"contained",onPress:async()=>{let t=[],m=[];g.forEach((d,M)=>{d.tmpDisabled||(t.push(d.id),m.push(b[M]))}),await te({newMemForm:{tags:v,content:D,customFields_user:P,id:c,title:f,category:S,img:A,parents_id:t,parents_rel:m},prevMem:s,selectedImg:K??null,captionTheImg:a,generate_customFields_model:n})},disabled:!f||!S||!1,children:"edit"}),s?.id&&e.jsxs(I,{children:[e.jsx(J,{icon:"information-outline",color:se,style:{margin:0,padding:0},size:15}),e.jsx(h,{children:l("you are editing: ")}),e.jsx(H,{style:{backgroundColor:O},width:20,height:20,src:`${s.img}`}),e.jsxs(h,{children:["  "," ",s.title_string]})]})]})]})})},["topMem","localAppSetting"]);export{he as EditMem_};

import{r as x,j as s,E as z,t as a,B as c,T as p,S as W,G,R as g,h as H,e as R,f as U,H as w,J as P,K as J,g as K,L as k,D as _,C as y,a as v,u as F,M as L,i as M,z as N,b as O,N as $,d as q}from"./osRouter-DXC_0-pa.js";import{R as Q}from"./ResponsiblePage-ySs7CmMw.js";import{T as X}from"./TextInput-6kzk1Lg_.js";import{I as Y,C as Z}from"./ImgChoosing-BzR_ZsIU.js";import{S as b}from"./SaveBox-CK7b3oym.js";import"./index-4JFvKWvb.js";import"./AnimatedBox-ClWMXiOi.js";import"./FileSelector-BILK1Qmg.js";function A({tmpDisabled:e,parentIndex:o,currentParents_RelToCurrentMem:t,set_currentParents_RelToCurrentMem:n}){const[r,j]=x.useState(t[o]??"");return s.jsx(s.Fragment,{children:s.jsx(X,{disabled:e,placeholder:a("relation..."),placeholderTextColor:z,defaultValue:r,onBlur:i=>{t[o]=r,n(t.slice())},onChangeText:i=>{j(i)}})})}function T({currentParents:e,set_currentParents:o,currentParents_RelToCurrentMem:t,set_currentParents_RelToCurrentMem:n}){return s.jsx(s.Fragment,{children:s.jsxs(c,{style:{},children:[s.jsxs(p,{children:[a("choose parents:")," "]}),s.jsx(c,{style:{},children:s.jsx(W,{height:100,style:{borderColor:"black",borderWidth:1},children:s.jsx(c,{style:{display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center",alignContent:"center",flexWrap:"wrap"},children:e==null?void 0:e.map((r,j)=>s.jsxs(c,{style:{borderColor:G,borderWidth:1,opacity:r.tmpDisabled?.5:1},children:[s.jsx(g,{children:s.jsxs(H,{onPress:()=>{const i=e.findIndex(h=>h.id==r.id);e[i].tmpDisabled=!e[i].tmpDisabled,o(e.slice())},children:[s.jsx(R,{style:{backgroundColor:U},width:20,height:20,src:r.img}),s.jsxs(p,{children:["  "," ",r.title_string]}),s.jsx(w,{icon:r.tmpDisabled?"close-circle-outline":"sticker-plus",color:r.tmpDisabled?P:J,style:{margin:0,padding:0},size:15})]})}),s.jsx(g,{children:s.jsx(A,{currentParents_RelToCurrentMem:t,set_currentParents_RelToCurrentMem:n,parentIndex:j,tmpDisabled:r.tmpDisabled})})]},r.id))})})})]})})}const ns=K(({topMem:e,localAppSetting:o})=>{const[t,n]=x.useState({id:null,parents_id:[],parents_rel:[],title:"",content:"",tags:"",img:"",customFields_user:{},category:""}),[r,j]=x.useState(null),[i,h]=x.useState(null),[f,I]=x.useState([]),[D,m]=x.useState([]);return x.useEffect(()=>{var l,u;if(e&&(n({id:null,parents_id:e.parents_id,parents_rel:e.parents_rel,title:e.title_string,content:e.content_string,tags:(l=e.tags)==null?void 0:l.join(" "),img:e.img??null,customFields_user:e.customFields_user,category:e.category??"general"}),h(e.img??null),(u=e.parents_id)!=null&&u.length)){const d=[];I(e.parents_id.map((S,C)=>{const V=k(S);return d[C]=e.parents_rel[C],{...V,tmpDisabled:!1}})),m(d)}},[e==null?void 0:e.id]),s.jsx(s.Fragment,{children:s.jsxs(Q,{containerStyles:{},children:[s.jsx(c,{style:{flexDirection:"column",marginBottom:20},children:s.jsx(b,{testID:"addMem_title",defaultValue:t==null?void 0:t.title,label:"e.g: http://localhost:8080",onSave:l=>n({...t,title:l})})}),s.jsx(c,{style:{flexDirection:"column",marginBottom:20},children:s.jsx(b,{testID:"addMem_category",label:"*"+a("category"),defaultValue:t==null?void 0:t.category,onSave:l=>{n({...t,category:l})}})}),s.jsx(c,{style:{flexDirection:"column",marginBottom:20},children:s.jsx(b,{style:{height:500},multiline:!0,testID:"addMem_content",defaultValue:t==null?void 0:t.content,label:a("content"),onSave:l=>n({...t,content:l})})}),s.jsx(c,{style:{marginBottom:20},children:s.jsx(b,{testID:"addMem_tags",defaultValue:t==null?void 0:t.tags,label:a("tags"),keyboardType:"numeric",onSave:l=>n({...t,tags:l})})}),s.jsx(_,{}),s.jsx(Y,{oldImg:e==null?void 0:e.img,currentImg:i,onImgUrlChanged:l=>{h(l)},onImgSelect:l=>{j(l)}}),s.jsxs(g,{children:[s.jsx(y,{children:s.jsx(p,{children:a("caption the image")})}),s.jsx(y,{children:s.jsx(v,{testID:"addMem_captionImg",status:o.captionTheImg?"checked":"unchecked",onPress:()=>F({newSetting:{captionTheImg:!o.captionTheImg}})})})]}),s.jsx(_,{}),s.jsxs(g,{children:[s.jsx(y,{children:s.jsxs(p,{children:[a("improve data retrieval and indexing of this mem")," "]})}),s.jsx(y,{children:s.jsx(v,{testID:"searchImprovementUsingCustomFields",status:o.generate_customFields_model?"checked":"unchecked",onPress:()=>F({newSetting:{generate_customFields_model:!o.generate_customFields_model}})})})]}),s.jsx(_,{}),s.jsx(T,{currentParents:f,currentParents_RelToCurrentMem:D,set_currentParents:I,set_currentParents_RelToCurrentMem:m}),s.jsx(L,{height:100,onSearch:async l=>{M({text:l,dontSet_userInputSearchBox:!0})},onItemClick:l=>{if(f.find(d=>d.id===l))return N({content:a("already added!"),type:"info"}),null;const u={...k(l),tmpDisabled:!1};I([...f,u]),m([...D,""])},onUserType:async l=>{(l[0]==="@"||l[0]==="#")&&M({text:l,dontSet_userInputSearchBox:!0})}}),s.jsx(_,{}),s.jsx(Z,{default_customFields_user:(t==null?void 0:t.customFields_user)??{},onUpdate:l=>{n(structuredClone({...t,customFields_user:l}))}}),s.jsx(_,{}),s.jsxs(c,{children:[s.jsx(O,{testID:"addMem_submit",icon:e!=null&&e.id?"plus-network":"shape-rectangle-plus",mode:"contained",onPress:async()=>{let l=[],u=[];f.forEach((d,S)=>{d.tmpDisabled||(l.push(d.id),u.push(D[S]))}),await $({newMemForm:{...t,img:i,parents_id:l,parents_rel:u},prevMem:e,selectedImg:r??null,captionTheImg:o.captionTheImg,generate_customFields_model:o.generate_customFields_model})},disabled:!t.title||!t.category||!1,children:"edit"}),(e==null?void 0:e.id)&&s.jsxs(g,{children:[s.jsx(w,{icon:"information-outline",color:q,style:{margin:0,padding:0},size:15}),s.jsx(p,{children:a("you are editing: ")}),s.jsx(R,{style:{backgroundColor:U},width:20,height:20,src:`${e.img}`}),s.jsxs(p,{children:["  "," ",e.title_string]})]})]})]})})},["topMem","localAppSetting"]);export{ns as EditMem_};
